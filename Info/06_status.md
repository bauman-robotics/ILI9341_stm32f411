# Состояние проекта ILI9341_STM32F411

## Текущее состояние проекта

### Структура проекта
- **Микроконтроллер**: STM32F411CEU6
- **Дисплей**: ILI9341/ST7789V 320x240 пикселей с тачскрином
- **ОС**: FreeRTOS
- **Интерфейс**: SPI1 для дисплея
- **Инструменты**: STM32CubeMX, VSCode, arm-none-eabi-gcc, make, st-flash

### Подключение периферии
- **SPI1**: PA5(SCK), PA6(MISO), PA7(MOSI), PB0(CS)
- **GPIO**: PB1(RST), PC13(LED), PC14(BACK_LIGHT)
- **Touch**: MSP2807 (T_IRQ, T_DO, T_DIN, T_CS, T_CLK)

## Выполненные доработки

### 1. Исследование проекта (01_pinouts.md)
- Изучены распиновки дисплея и подключение
- Понято назначение пинов для SPI, GPIO, touch

### 2. План работы (03_plan.md)
- Составлен детальный план реализации Hello-World на дисплее
- Определены шаги: драйвер ILI9341, шрифты, FreeRTOS интеграция

### 3. Инструментарий (04_tools.md)
- Составлен список необходимого ПО для компиляции и отладки
- Добавлены команды проверки наличия инструментов в Linux

### 4. Шрифты (05_fonts.md)
- Исследованы способы получения шрифтов для TFT дисплеев
- Найдены источники шрифтов с поддержкой кириллицы
- Определены инструменты для создания кастомных шрифтов

### 5. LED blinking (freertos.c)
- Реализован код мигания светодиода PC13 через FreeRTOS
- Добавлен include "gpio.h"
- Задача StartDefaultTask модифицирована для toggle LED каждые 500ms

### 6. VSCode конфигурация (.vscode/)
- Создан tasks.json с задачами: Build, Clean, Flash, Build and Flash
- Настроены горячие клавиши: Ctrl+Shift+B/C/F/A
- Добавлен c_cpp_properties.json для IntelliSense
- Кнопка сборки появилась в статус баре

### 7. Драйвер тачскрина (touch.c)
- Реализована инициализация тачскрина MSP2807
- Добавлена поддержка прерываний от тачскрина
- Настроен SPI2 для коммуникации с тачскрином

### 8. Исправления FreeRTOS и HAL
- Выделена достаточная память для тасков FreeRTOS
- Исправлена проблема с запуском отладчика
- Решена проблема с hal_delay() в тасках

## Проблемы и решения

### Решенные проблемы
- **Компиляция**: Проект успешно компилируется с make
- **FreeRTOS**: Корректно настроен, задача LED работает, выделена достаточная память для тасков
- **VSCode**: Настроены задачи и горячие клавиши
- **Отладчик**: Исправлена проблема с запуском отладчика
- **HAL Delay**: Решена проблема с hal_delay() в тасках
- **Touch**: Реализован драйвер тачскрина MSP2807 с инициализацией и прерываниями

### Текущие проблемы
- **Отсутствие драйвера ILI9341**: Нет кода для инициализации и управления дисплеем
- **Нет шрифтов**: Требуется интеграция bitmap шрифтов
- **st-flash**: Требуется установка и проверка работы

### Потенциальные проблемы
- **Timing SPI**: Может потребоваться настройка DMA для быстрой передачи данных на дисплей
- **Память**: Bitmap шрифты могут занимать много места
- **Кириллица**: Требуется правильная кодировка и шрифты

## Следующие шаги
1. Реализовать базовый драйвер ILI9341
2. Добавить функции рисования пикселей и текста
3. Создать задачу Hello World в FreeRTOS
4. Протестировать на hardware

## Лог изменений
- **18.12.2025**: Начальная настройка проекта, LED blinking, VSCode конфигурация
- **19.12.2025**: Исправления FreeRTOS (память для тасков), отладчик, hal_delay в тасках. Реализация драйвера тачскрина с инициализацией и прерываниями. Видны прерывания от тачскрина на логическом анализаторе.
