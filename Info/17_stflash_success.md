# –£—Å–ø–µ—à–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ flash —á–µ—Ä–µ–∑ st-flash

## –ö–æ–º–∞–Ω–¥–∞ –æ—á–∏—Å—Ç–∫–∏
```bash
# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–π flash –ø–∞–º—è—Ç–∏
st-flash erase
```

–≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ö–æ–º–∞–Ω–¥–∞ —É—Å–ø–µ—à–Ω–æ —Å—Ç–µ—Ä–ª–∞ –≤—Å—é flash –ø–∞–º—è—Ç—å STM32F411.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏

### –®–∞–≥ 1: –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ELF –≤ BIN (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
```bash
arm-none-eabi-objcopy -O binary build/ILI9341_stm32f411.elf build/ILI9341_stm32f411.bin
```

### –®–∞–≥ 2: –ó–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ—à–∏–≤–∫—É
```bash
st-flash write build/ILI9341_stm32f411.bin 0x8000000
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
st-flash 1.7.0-136-g2fc4
2023-10-05T15:57:20 INFO common.c: Flash written and verified! jolly good!
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å OpenOCD –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
```bash
openocd -f openocd.cfg
```

### –®–∞–≥ 4: –ü–æ–¥–∫–ª—é—á–∏—Ç—å GDB –≤ –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
```bash
arm-none-eabi-gdb build/ILI9341_stm32f411.elf -ex "target extended-remote localhost:3333" -ex "monitor reset halt" -ex "break main" -ex "continue"
```

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞)

```bash
# –ü–æ–ª–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
st-flash erase && \
arm-none-eabi-objcopy -O binary build/ILI9341_stm32f411.elf build/ILI9341_stm32f411.bin && \
st-flash write build/ILI9341_stm32f411.bin 0x8000000 && \
echo "–ü—Ä–æ—à–∏–≤–∫–∞ –∑–∞–ø–∏—Å–∞–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º OpenOCD..." && \
openocd -f openocd.cfg
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ OpenOCD –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:
```
Info : accepting 'gdb' connection on tcp/3333
Info : [stm32f4x.cpu] halted due to debug-request, current mode: Thread
xPSR: 0x01000000 pc: 0xfffffffe msp: 0x20020000
```

–í GDB:
- –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–∞ `main()` (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ç–æ—á–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∞)
- –ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ—Ç–ª–∞–¥–∫—É: `step`, `next`, `print`, `watch` –∏ —Ç.–¥.

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

### –ï—Å–ª–∏ st-flash write –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ST-Link
st-info --probe

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é
st-flash --version
```

### –ï—Å–ª–∏ OpenOCD –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏:
```bash
# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–±—Ä–æ—Å —á–µ—Ä–µ–∑ telnet
telnet localhost 4444
> reset halt
> exit
```

### –ï—Å–ª–∏ GDB –Ω–µ –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∏–º–≤–æ–ª—ã:
```bash
# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ ELF —Ñ–∞–π–ª —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–Ω–æ–π –ø—Ä–æ—à–∏–≤–∫–µ
file build/ILI9341_stm32f411.elf
```

## –†–µ–∑—é–º–µ —É—Å–ø–µ—à–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. ‚úÖ **–û—á–∏—Å—Ç–∫–∞ flash**: `st-flash erase`
2. üîÑ **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è**: `arm-none-eabi-objcopy -O binary ...`
3. üîÑ **–ó–∞–ø–∏—Å—å**: `st-flash write ... 0x8000000`
4. üîÑ **–û—Ç–ª–∞–¥–∫–∞**: `openocd -f openocd.cfg` + `arm-none-eabi-gdb ...`

–¢–µ–ø–µ—Ä—å –æ—Ç–ª–∞–¥–∫–∞ STM32F411 –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!
