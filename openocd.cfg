# OpenOCD configuration for STM32F411 Black Pill
# Usage: openocd -f openocd.cfg

# Interface
source [find interface/stlink.cfg]

# Target
source [find target/stm32f4x.cfg]

# Adapter speed - установите низкую скорость для надежности
adapter speed 480

# Reset configuration
reset_config srst_only connect_assert_srst

# Prevent speed changes during reset
$_TARGETNAME configure -event reset-start {
    adapter speed 480
}

$_TARGETNAME configure -event reset-init {
    adapter speed 480
}

$_TARGETNAME configure -event reset-end {
    adapter speed 480
}

# Enable gdb
gdb_port 3333
telnet_port 4444
tcl_port 6666

# Working area
$_TARGETNAME configure -work-area-phys 0x20000000 -work-area-size 0x4000

# Initialization commands
init
arm semihosting enable