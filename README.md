# ILI9341_STM32F411 - TFT –¥–∏—Å–ø–ª–µ–π —Å FreeRTOS

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É TFT –¥–∏—Å–ø–ª–µ—è ILI9341 —Å –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º STM32F411CEU6 –Ω–∞ –±–∞–∑–µ FreeRTOS. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –±–µ–≥—É—â–µ–π —Å—Ç—Ä–æ–∫–∏ –±–µ–∑ –º–µ—Ä—Ü–∞–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä ILI9341** —Å landscape –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–µ–π (320x240)
- **–î–≤–∞ —Ä–∞–±–æ—á–∏—Ö —à—Ä–∏—Ñ—Ç–∞**: Font1 (5x7) –∏ Font1_2x (10x14)
- **–ë–µ–≥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ "Hello World!"** –±–µ–∑ –º–µ—Ä—Ü–∞–Ω–∏—è (50 FPS)
- **USB CDC –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** —Å double buffering

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **STM32F411CEU6** (Black Pill –∏–ª–∏ –∞–Ω–∞–ª–æ–≥)
- **ILI9341 TFT –¥–∏—Å–ø–ª–µ–π** (320x240, SPI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- **arm-none-eabi-gcc** toolchain
- **make** –¥–ª—è —Å–±–æ—Ä–∫–∏
- **st-flash** –¥–ª—è –ø—Ä–æ—à–∏–≤–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
```
STM32F411          ILI9341
PA5 (SPI1_SCK) ‚îÄ‚îÄ‚ñ∫ SCK
PA6 (SPI1_MISO) ‚îÄ‚îÄ‚ñ∫ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
PA7 (SPI1_MOSI) ‚îÄ‚îÄ‚ñ∫ SDA/MOSI
PB0              ‚îÄ‚îÄ‚ñ∫ CS
PB1              ‚îÄ‚îÄ‚ñ∫ RST
PA8              ‚îÄ‚îÄ‚ñ∫ DC
PC14             ‚îÄ‚îÄ‚ñ∫ LED (–ø–æ–¥—Å–≤–µ—Ç–∫–∞)
GND              ‚îÄ‚îÄ‚ñ∫ GND
3.3V             ‚îÄ‚îÄ‚ñ∫ VCC
```

### –°–±–æ—Ä–∫–∞ –∏ –ø—Ä–æ—à–∏–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd ILI9341_STM32F411

# –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
make

# –ü—Ä–æ—à–∏—Ç—å —á–µ—Ä–µ–∑ ST-Link
make flash

# –ò–ª–∏ —Å–æ–±—Ä–∞—Ç—å –∏ –ø—Ä–æ—à–∏—Ç—å –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
make all-flash
```

## üìã –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

–ü—Ä–æ–µ–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `Core/Inc/config.h`:

### 1. –†–µ–∂–∏–º –∞–ª—Ñ–∞–≤–∏—Ç–∞ (`TASK_ALPHABET_DISPLAY`)
```c
#define TASK_ALPHABET_DISPLAY 1
#define TASK_SCROLLING_HELLO 0
```
**–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç:**
- –ü–æ–ª–Ω—ã–π –∞–ª—Ñ–∞–≤–∏—Ç A-Z –∏ a-z
- –î–≤–∞ —à—Ä–∏—Ñ—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 2. –†–µ–∂–∏–º –±–µ–≥—É—â–µ–π —Å—Ç—Ä–æ–∫–∏ (`TASK_SCROLLING_HELLO`)
```c
#define TASK_ALPHABET_DISPLAY 0
#define TASK_SCROLLING_HELLO 1
```
**–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç:**
- –ü–ª–∞–≤–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é "Hello World! "
- –ö—Ä—É–ø–Ω—ã–π —à—Ä–∏—Ñ—Ç (–º–∞—Å—à—Ç–∞–± 2x)
- –ë–µ–∑ –º–µ—Ä—Ü–∞–Ω–∏—è (double buffering)

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Double Buffering
–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—É—é —Ç–µ—Ö–Ω–∏–∫—É double buffering –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ä—Ü–∞–Ω–∏—è:

```
Font1 Data ‚îÄ‚îÄ‚ñ∂ Software Buffer ‚îÄ‚îÄ‚ñ∂ ILI9341 SPI
  (5x7)         (320x30 pixels)    (38,400 bytes)
```

- **Software framebuffer**: 19,200 –±–∞–π—Ç RAM
- **–û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤ –ø–∞–º—è—Ç–∏**: –ë—ã—Å—Ç—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ SPI
- **–ï–¥–∏–Ω–∏—á–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞**: –ü–æ–ª–Ω—ã–π –∫–∞–¥—Ä –∑–∞ –æ–¥–∏–Ω SPI –≤—ã–∑–æ–≤
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 50 FPS –±–µ–∑ –º–µ—Ä—Ü–∞–Ω–∏—è

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **–£–º–Ω–æ–µ —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å—Ç–∏—Ä–∞–Ω–∏–µ** - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –æ–±–ª–∞—Å—Ç–∏
2. **DMA –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø–µ—Ä–µ–¥–∞—á** - —É—Å–∫–æ—Ä–µ–Ω–∏–µ SPI –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏** - 20ms –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
4. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –±—É—Ñ–µ—Ä—ã

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ILI9341_STM32F411/
‚îú‚îÄ‚îÄ Core/
‚îÇ   ‚îú‚îÄ‚îÄ Inc/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.h          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–µ–∂–∏–º–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fonts.h           # –®—Ä–∏—Ñ—Ç—ã –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ili9341.h         # –î—Ä–∞–π–≤–µ—Ä –¥–∏—Å–ø–ª–µ—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.h          # USB CDC –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.h            # –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ Src/
‚îÇ       ‚îú‚îÄ‚îÄ fonts.c           # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤
‚îÇ       ‚îú‚îÄ‚îÄ freertos.c        # FreeRTOS –∑–∞–¥–∞—á–∏
‚îÇ       ‚îú‚îÄ‚îÄ ili9341.c         # –î—Ä–∞–π–≤–µ—Ä ILI9341
‚îÇ       ‚îú‚îÄ‚îÄ logger.c          # USB –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ       ‚îî‚îÄ‚îÄ main.c            # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ Drivers/                  # HAL –¥—Ä–∞–π–≤–µ—Ä—ã STM32
‚îú‚îÄ‚îÄ Middlewares/              # FreeRTOS, USB
‚îú‚îÄ‚îÄ Info/                     # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ 01_pinouts.md         # –†–∞—Å–ø–∏–Ω–æ–≤–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ 03_plan.md           # –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ 04_tools.md          # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ 05_fonts.md          # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —à—Ä–∏—Ñ—Ç–∞—Ö
‚îÇ   ‚îú‚îÄ‚îÄ 06_status.md         # –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ 07_display_optimization.md # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ .vscode/                  # VSCode –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Makefile                  # –°–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∫–∏
‚îú‚îÄ‚îÄ STM32F411CEUx_FLASH.ld    # Linker script
‚îú‚îÄ‚îÄ startup_stm32f411xe.s     # Startup –∫–æ–¥
‚îî‚îÄ‚îÄ README.md                 # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üîß –°–±–æ—Ä–∫–∞ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### VSCode –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
–ü—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ VSCode:
- **Tasks**: Build, Clean, Flash, Build & Flash
- **–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏**: Ctrl+Shift+B (—Å–±–æ—Ä–∫–∞), Ctrl+Shift+F (–ø—Ä–æ—à–∏–≤–∫–∞)
- **IntelliSense**: –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è

### –ö–æ–º–∞–Ω–¥—ã —Å–±–æ—Ä–∫–∏
```bash
make            # –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
make clean      # –û—á–∏—Å—Ç–∏—Ç—å build artifacts
make flash      # –ü—Ä–æ—à–∏—Ç—å —á–µ—Ä–µ–∑ ST-Link
make all-flash  # –°–æ–±—Ä–∞—Ç—å –∏ –ø—Ä–æ—à–∏—Ç—å
```

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

- **–ú–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä**: STM32F411CEU6 (100MHz Cortex-M4)
- **–î–∏—Å–ø–ª–µ–π**: ILI9341 320x240 RGB565
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: SPI1 (36MHz max)
- **–û–°**: FreeRTOS 10.4.6
- **–ü–∞–º—è—Ç—å**: ~75KB –±–∏–Ω–∞—Ä–Ω–∏–∫, 19KB RAM –±—É—Ñ–µ—Ä
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 50 FPS –∞–Ω–∏–º–∞—Ü–∏—è –±–µ–∑ –º–µ—Ä—Ü–∞–Ω–∏—è

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –î–∏—Å–ø–ª–µ–π –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∏—á–µ–≥–æ
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è –∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SPI –ø–∏–Ω—ã (PA5, PA7, PB0, PA8)
3. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–µ–∂–∏–º –∞–ª—Ñ–∞–≤–∏—Ç–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –ú–µ—Ä—Ü–∞–Ω–∏–µ –ø—Ä–∏ –∞–Ω–∏–º–∞—Ü–∏–∏
- –í –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω double buffering –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ä—Ü–∞–Ω–∏—è
- –ï—Å–ª–∏ –º–µ—Ä—Ü–∞–Ω–∏–µ –≤—Å–µ –∂–µ –µ—Å—Ç—å, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É SPI

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–º–ø–∏–ª—è—Ü–∏–µ–π
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
make clean && make

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å toolchain
arm-none-eabi-gcc --version
```

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ü—Ä–æ–µ–∫—Ç –æ—Ç–∫—Ä—ã—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π! –í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

- **Touch –¥—Ä–∞–π–≤–µ—Ä** –¥–ª—è MSP2807
- **–ö–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–µ —à—Ä–∏—Ñ—Ç—ã**
- **–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤—ã** (–ª–∏–Ω–∏–∏, –∫—Ä—É–≥–∏)
- **DMA –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** –¥–ª—è –≤—Å–µ–≥–æ —ç–∫—Ä–∞–Ω–∞
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –±—É—Ñ–µ—Ä—ã** –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å, –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –≥–∞—Ä–∞–Ω—Ç–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ —Å–≤–æ–π —Å—Ç—Ä–∞—Ö –∏ —Ä–∏—Å–∫.

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ issues –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

---

**–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ILI9341 —Å STM32F411!** üéâ
